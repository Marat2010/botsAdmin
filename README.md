# botsAdmin
## Администратор ТГ ботов


**Папки:**  
- **"Prodamus"** - сервис оплаты.  
  Для быстрого развертывания на VPS, подключитесь к нему, выполните команду и следуйте инструкциям:  
  ```
    wget -O ./deployVPS.sh https://raw.githubusercontent.com/Marat2010/botsAdmin/master/Prodamus/deployVPS.sh && chmod +x deployVPS.sh && ./deployVPS.sh
    ```
  _Сделано:_
  - **формирование ссылки на оплату (файл "payment_link.py").**  
    Основные данные это:
      - URL платежной формы (linktoform)  
      - Словарь "data" . Информация об заказе, клиенте, продукте, и три ссылки:
        - для уведомления об успешной оплате.
        - для возврата клиента при успешной оплате
        - для возврата клиента без оплаты.  

  - **Уведомление об успешной оплате (файл "payment_verification.py")**    
    _Порядок проверки:_  
      - Запускаем сервер aiohttp (python payment_verification.py) для принятия уведомлений об оплате.  
      - Запускаем формирование ссылки на оплату (python payment_link.py)
      - Переход по сформированной ссылки.
      - Производим оплату на сайте продамуса. Должно перебросить на соответсвующую страницу.
      - Проверяем сообщения на сервере об оплате, и совпадения подписей.  
       
    Некоторые моменты.  
      - Из файлов (payment_link, payment_verification) убраны все утилиты для формирования ссылки и подписи в файл "utils_prodamus.py".  
      - Чтобы данные приходили к нам в формате json, не забывать при формирования ссылки в словаре "data"
    выставлять параметр **'callbackType': 'json'**
      - Также не забывать убрать демо режим **'demo_mode': 1**
      - Подготовлен файл **"payment_verification.service"**, чтобы вешать запуск сервера aiohttp как сервис на VPS.
  - **Заносим данные в БД SQLite об успешной оплате**  
    Из файла **"payment_verification.py"** вызывется метод **add_payments**. В нем вытаскиваем нужные ключи из 
   словаря данных и помещаем в кортеж. Далее этот кортеж помещаем в БД.  
  Делаются некоторые проверки, такие как, если нет файла БД SQLite (то автоматом создается), проверка на кол-во переданных параметров.

  _Необходимо сделать:_
   - ~~**Заносить данные в БД об успешной оплате**~~ сделано  
   - ~~Сделать подгрузку переменных окружения через settings Pydantic~~  
   - ~~Продумать куда дальше боту, ботам отправлять уведомления~~  


- **"Multibot"** - управление ботами.  

  _Сделано:_  
  - Запуск добавление бота (Если повторно, то не дает)
  - Запуск Redis у себя пока локально, можно сделать в докере 
  
  _Необходимо:_
   - ...


- **"Auth"** - все, что касается авторизации.  
    _Сделано:_
  - Переведен на вебхук.
  
